// +build integration

package integration

import (
	"context"
	"io/ioutil"
	"os"
	"testing"
	"time"

	"github.com/aquasecurity/fanal/analyzer"
	"github.com/aquasecurity/fanal/extractor/docker"
	godeptypes "github.com/aquasecurity/go-dep-parser/pkg/types"
	dtypes "github.com/docker/docker/api/types"
	"github.com/docker/docker/client"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"

	_ "github.com/aquasecurity/fanal/analyzer/command/apk"
	_ "github.com/aquasecurity/fanal/analyzer/library/bundler"
	_ "github.com/aquasecurity/fanal/analyzer/library/cargo"
	_ "github.com/aquasecurity/fanal/analyzer/library/composer"
	_ "github.com/aquasecurity/fanal/analyzer/library/npm"
	_ "github.com/aquasecurity/fanal/analyzer/library/pipenv"
	_ "github.com/aquasecurity/fanal/analyzer/library/poetry"
	_ "github.com/aquasecurity/fanal/analyzer/library/yarn"
	_ "github.com/aquasecurity/fanal/analyzer/os/alpine"
	_ "github.com/aquasecurity/fanal/analyzer/os/amazonlinux"
	_ "github.com/aquasecurity/fanal/analyzer/os/debianbase"
	_ "github.com/aquasecurity/fanal/analyzer/os/photon"
	_ "github.com/aquasecurity/fanal/analyzer/os/redhatbase"
	_ "github.com/aquasecurity/fanal/analyzer/os/suse"
	_ "github.com/aquasecurity/fanal/analyzer/pkg/apk"
	_ "github.com/aquasecurity/fanal/analyzer/pkg/dpkg"
	_ "github.com/aquasecurity/fanal/analyzer/pkg/rpm"

	"github.com/aquasecurity/fanal/cache"
	"github.com/aquasecurity/fanal/types"
)

func TestFanal_Library_DockerMode(t *testing.T) {
	testCases := []struct {
		name                 string
		imageName            string
		imageFile            string
		expectedFiles        []string
		expectedOS           analyzer.OS
		expectedPkgs         []analyzer.Package
		expectedPkgsFromCmds []analyzer.Package
		expectedLibraries    map[analyzer.FilePath][]godeptypes.Library
	}{
		{
			name:      "happy path, alpine:3.10",
			imageName: "alpine:3.10",
			imageFile: "testdata/fixtures/alpine-310.tar.gz",
			expectedOS: analyzer.OS{
				Name:   "3.10.2",
				Family: "alpine",
			},
			expectedFiles: []string{"etc/alpine-release", "etc/os-release", "lib/apk/db/installed", "/config"},
			expectedPkgs: []analyzer.Package{
				{Name: "musl", Version: "1.1.22-r3"},
				{Name: "busybox", Version: "1.30.1-r2"},
				{Name: "alpine-baselayout", Version: "3.1.2-r0"},
				{Name: "alpine-keys", Version: "2.1-r2"},
				{Name: "openssl", Version: "1.1.1c-r0"},
				{Name: "libcrypto1.1", Version: "1.1.1c-r0"},
				{Name: "libssl1.1", Version: "1.1.1c-r0"},
				{Name: "ca-certificates", Version: "20190108-r0"},
				{Name: "ca-certificates-cacert", Version: "20190108-r0"},
				{Name: "libtls-standalone", Version: "2.9.1-r0"},
				{Name: "ssl_client", Version: "1.30.1-r2"},
				{Name: "zlib", Version: "1.2.11-r1"},
				{Name: "apk-tools", Version: "2.10.4-r2"},
				{Name: "pax-utils", Version: "1.2.3-r0"},
				{Name: "scanelf", Version: "1.2.3-r0"},
				{Name: "musl-utils", Version: "1.1.22-r3"},
				{Name: "libc-dev", Version: "0.7.1-r0"},
				{Name: "libc-utils", Version: "0.7.1-r0"},
			},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
		{
			name:              "happy path, amazonlinux:2",
			imageName:         "amazonlinux:2",
			imageFile:         "testdata/fixtures/amazon-2.tar.gz",
			expectedFiles:     []string{"etc/system-release", "var/lib/rpm/Packages", "etc/os-release", "/config"},
			expectedOS:        analyzer.OS{Name: "2 (Karoo)", Family: "amazon"},
			expectedPkgs:      []analyzer.Package{analyzer.Package{Name: "system-release", Version: "2", Release: "10.amzn2", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcc", Version: "7.3.1", Release: "5.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc", Version: "2.26", Release: "32.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pcre", Version: "8.32", Release: "17.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nspr", Version: "4.19.0", Release: "1.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bzip2-libs", Version: "1.0.6", Release: "13.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "elfutils-libelf", Version: "0.170", Release: "4.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libacl", Version: "2.2.51", Release: "14.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sqlite", Version: "3.7.17", Release: "8.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-softokn-freebl", Version: "3.36.0", Release: "5.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "file-libs", Version: "5.11", Release: "33.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "keyutils-libs", Version: "1.5.8", Release: "3.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gdbm", Version: "1.13", Release: "6.amzn2.0.2", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gawk", Version: "4.0.2", Release: "4.amzn2.1.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gmp", Version: "6.0.0", Release: "15.amzn2.0.2", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ca-certificates", Version: "2018.2.22", Release: "70.0.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "krb5-libs", Version: "1.15.1", Release: "20.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python", Version: "2.7.14", Release: "58.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libblkid", Version: "2.30.2", Release: "2.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-metadata-parser", Version: "1.1.4", Release: "10.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-tools", Version: "3.36.0", Release: "7.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "curl", Version: "7.61.1", Release: "9.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gnupg2", Version: "2.0.22", Release: "5.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pygpgme", Version: "0.3", Release: "9.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-plugin-priorities", Version: "1.1.31", Release: "46.amzn2.0.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc-langpack-en", Version: "2.26", Release: "32.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-base", Version: "6.0", Release: "8.20170212.amzn2.1.2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "basesystem", Version: "10.0", Release: "7.amzn2.0.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc-common", Version: "2.26", Release: "32.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libstdc++", Version: "7.3.1", Release: "5.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "info", Version: "5.1", Release: "5.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "xz-libs", Version: "5.2.2", Release: "1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "lua", Version: "5.1.4", Release: "15.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libattr", Version: "2.4.46", Release: "12.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "chkconfig", Version: "1.7.4", Release: "1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libxml2", Version: "2.9.1", Release: "6.amzn2.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "grep", Version: "2.20", Release: "3.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcrypt", Version: "2.26", Release: "32.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcrypt", Version: "1.5.3", Release: "14.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cpio", Version: "2.11", Release: "27.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "findutils", Version: "4.5.11", Release: "5.amzn2.0.2", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit-trust", Version: "0.23.5", Release: "3.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libverto", Version: "0.2.5", Release: "4.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-libs", Version: "2.7.14", Release: "58.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-iniparse", Version: "0.4", Release: "9.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "shared-mime-info", Version: "1.8", Release: "4.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss", Version: "3.36.0", Release: "7.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcurl", Version: "7.61.1", Release: "9.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openldap", Version: "2.4.44", Release: "15.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpgme", Version: "1.3.2", Release: "5.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum", Version: "3.4.3", Release: "158.amzn2.0.2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "vim-minimal", Version: "7.4.160", Release: "4.amzn2.0.16", Epoch: 2, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tzdata", Version: "2018i", Release: "1.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "filesystem", Version: "3.2", Release: "25.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc-minimal-langpack", Version: "2.26", Release: "32.amzn2.0.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsepol", Version: "2.5", Release: "8.1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "zlib", Version: "1.2.7", Release: "17.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb", Version: "5.3.21", Release: "24.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "popt", Version: "1.13", Release: "16.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libffi", Version: "3.0.13", Release: "18.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpg-error", Version: "1.12", Release: "3.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit", Version: "0.23.5", Release: "3.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sed", Version: "4.2.2", Release: "5.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "expat", Version: "2.1.0", Release: "10.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pinentry", Version: "0.8.1", Release: "17.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "diffutils", Version: "3.3", Release: "4.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libidn2", Version: "2.0.4", Release: "1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtasn1", Version: "4.10", Release: "1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnghttp2", Version: "1.31.1", Release: "1.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "coreutils", Version: "8.22", Release: "21.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pyxattr", Version: "0.5.1", Release: "5.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glib2", Version: "2.54.2", Release: "2.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-sysinit", Version: "3.36.0", Release: "7.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cyrus-sasl-lib", Version: "2.1.26", Release: "23.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm", Version: "4.11.3", Release: "25.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-python", Version: "4.11.3", Release: "25.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-urlgrabber", Version: "3.10", Release: "8.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "amazon-linux-extras", Version: "1.6.7", Release: "1.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg-pubkey", Version: "c87f5b1a", Release: "593863f8", Epoch: 0, Arch: "(none)", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "setup", Version: "2.8.71", Release: "10.amzn2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bash", Version: "4.2.46", Release: "30.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-libs", Version: "6.0", Release: "8.20170212.amzn2.1.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libselinux", Version: "2.5", Release: "12.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-util", Version: "3.36.0", Release: "1.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "readline", Version: "6.2", Release: "10.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcom_err", Version: "1.42.9", Release: "12.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap", Version: "2.22", Release: "9.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libassuan", Version: "2.1.0", Release: "3.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-softokn", Version: "3.36.0", Release: "5.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libuuid", Version: "2.30.2", Release: "2.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmetalink", Version: "0.1.2", Release: "7.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb-utils", Version: "5.3.21", Release: "24.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libunistring", Version: "0.9.3", Release: "9.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses", Version: "6.0", Release: "8.20170212.amzn2.1.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pth", Version: "2.0.7", Release: "23.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openssl-libs", Version: "1.0.2k", Release: "16.amzn2.1.1", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pyliblzma", Version: "0.5.3", Release: "11.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmount", Version: "2.30.2", Release: "2.amzn2.0.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-pem", Version: "1.0.3", Release: "5.amzn2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libssh2", Version: "1.4.3", Release: "12.amzn2.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-libs", Version: "4.11.3", Release: "25.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-build-libs", Version: "4.11.3", Release: "25.amzn2.0.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-pycurl", Version: "7.19.0", Release: "19.amzn2.0.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-plugin-ovl", Version: "1.1.31", Release: "46.amzn2.0.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
		{
			name:              "happy path, debian:buster",
			imageName:         "debian:buster",
			imageFile:         "testdata/fixtures/debian-buster.tar.gz",
			expectedFiles:     []string{"var/lib/dpkg/status", "etc/debian_version", "etc/os-release", "usr/lib/os-release", "/config"},
			expectedOS:        analyzer.OS{Name: "10.1", Family: "debian"},
			expectedPkgs:      []analyzer.Package{analyzer.Package{Name: "coreutils", Version: "8.30-3", Release: "", Epoch: 0, Arch: "", SrcName: "coreutils", SrcVersion: "8.30-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "debian-archive-keyring", Version: "2019.1", Release: "", Epoch: 0, Arch: "", SrcName: "debian-archive-keyring", SrcVersion: "2019.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "diffutils", Version: "1:3.7-3", Release: "", Epoch: 0, Arch: "", SrcName: "diffutils", SrcVersion: "1:3.7-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcc1", Version: "1:8.3.0-6", Release: "", Epoch: 0, Arch: "", SrcName: "gcc-8", SrcVersion: "8.3.0-6", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpg-error0", Version: "1.35-1", Release: "", Epoch: 0, Arch: "", SrcName: "libgpg-error", SrcVersion: "1.35-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tar", Version: "1.30+dfsg-6", Release: "", Epoch: 0, Arch: "", SrcName: "tar", SrcVersion: "1.30+dfsg-6", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "base-passwd", Version: "3.5.46", Release: "", Epoch: 0, Arch: "", SrcName: "base-passwd", SrcVersion: "3.5.46", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bash", Version: "5.0-4", Release: "", Epoch: 0, Arch: "", SrcName: "bash", SrcVersion: "5.0-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dash", Version: "0.5.10.2-5", Release: "", Epoch: 0, Arch: "", SrcName: "dash", SrcVersion: "0.5.10.2-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gcc-8-base", Version: "8.3.0-6", Release: "", Epoch: 0, Arch: "", SrcName: "gcc-8", SrcVersion: "8.3.0-6", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcrypt20", Version: "1.8.4-5", Release: "", Epoch: 0, Arch: "", SrcName: "libgcrypt20", SrcVersion: "1.8.4-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "zlib1g", Version: "1:1.2.11.dfsg-1", Release: "", Epoch: 0, Arch: "", SrcName: "zlib", SrcVersion: "1:1.2.11.dfsg-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bsdutils", Version: "1:2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "e2fsprogs", Version: "1.44.5-1+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "e2fsprogs", SrcVersion: "1.44.5-1+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "iproute2", Version: "4.20.0-2", Release: "", Epoch: 0, Arch: "", SrcName: "iproute2", SrcVersion: "4.20.0-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libhogweed4", Version: "3.4.1-1", Release: "", Epoch: 0, Arch: "", SrcName: "nettle", SrcVersion: "3.4.1-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libxtables12", Version: "1.8.2-4", Release: "", Epoch: 0, Arch: "", SrcName: "iptables", SrcVersion: "1.8.2-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "login", Version: "1:4.5-1.1", Release: "", Epoch: 0, Arch: "", SrcName: "shadow", SrcVersion: "1:4.5-1.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "fdisk", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libbz2-1.0", Version: "1.0.6-9.2~deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "bzip2", SrcVersion: "1.0.6-9.2~deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libc-bin", Version: "2.28-10", Release: "", Epoch: 0, Arch: "", SrcName: "glibc", SrcVersion: "2.28-10", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libfdisk1", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtinfo6", Version: "6.1+20181013-2+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "ncurses", SrcVersion: "6.1+20181013-2+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gzip", Version: "1.9-3", Release: "", Epoch: 0, Arch: "", SrcName: "gzip", SrcVersion: "1.9-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libc6", Version: "2.28-10", Release: "", Epoch: 0, Arch: "", SrcName: "glibc", SrcVersion: "2.28-10", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpam-modules-bin", Version: "1.3.1-5", Release: "", Epoch: 0, Arch: "", SrcName: "pam", SrcVersion: "1.3.1-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libss2", Version: "1.44.5-1+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "e2fsprogs", SrcVersion: "1.44.5-1+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libstdc++6", Version: "8.3.0-6", Release: "", Epoch: 0, Arch: "", SrcName: "gcc-8", SrcVersion: "8.3.0-6", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "util-linux", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "apt", Version: "1.8.2", Release: "", Epoch: 0, Arch: "", SrcName: "apt", SrcVersion: "1.8.2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap-ng0", Version: "0.7.9-2", Release: "", Epoch: 0, Arch: "", SrcName: "libcap-ng", SrcVersion: "0.7.9-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap2", Version: "1:2.25-2", Release: "", Epoch: 0, Arch: "", SrcName: "libcap2", SrcVersion: "1:2.25-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "iputils-ping", Version: "3:20180629-2", Release: "", Epoch: 0, Arch: "", SrcName: "iputils", SrcVersion: "3:20180629-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdebconfclient0", Version: "0.249", Release: "", Epoch: 0, Arch: "", SrcName: "cdebconf", SrcVersion: "0.249", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmount1", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnettle6", Version: "3.4.1-1", Release: "", Epoch: 0, Arch: "", SrcName: "nettle", SrcVersion: "3.4.1-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsemanage-common", Version: "2.8-2", Release: "", Epoch: 0, Arch: "", SrcName: "libsemanage", SrcVersion: "2.8-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsepol1", Version: "2.8-1", Release: "", Epoch: 0, Arch: "", SrcName: "libsepol", SrcVersion: "2.8-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "passwd", Version: "1:4.5-1.1", Release: "", Epoch: 0, Arch: "", SrcName: "shadow", SrcVersion: "1:4.5-1.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libudev1", Version: "241-7~deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "systemd", SrcVersion: "241-7~deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "mawk", Version: "1.3.3-17+b3", Release: "", Epoch: 0, Arch: "", SrcName: "mawk", SrcVersion: "1.3.3-17", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "base-files", Version: "10.3+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "base-files", SrcVersion: "10.3+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dpkg", Version: "1.19.7", Release: "", Epoch: 0, Arch: "", SrcName: "dpkg", SrcVersion: "1.19.7", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libapt-pkg5.0", Version: "1.8.2", Release: "", Epoch: 0, Arch: "", SrcName: "apt", SrcVersion: "1.8.2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libaudit1", Version: "1:2.8.4-3", Release: "", Epoch: 0, Arch: "", SrcName: "audit", SrcVersion: "1:2.8.4-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgmp10", Version: "2:6.1.2+dfsg-4", Release: "", Epoch: 0, Arch: "", SrcName: "gmp", SrcVersion: "2:6.1.2+dfsg-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtasn1-6", Version: "4.13-3", Release: "", Epoch: 0, Arch: "", SrcName: "libtasn1-6", SrcVersion: "4.13-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "mount", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libelf1", Version: "0.176-1.1", Release: "", Epoch: 0, Arch: "", SrcName: "elfutils", SrcVersion: "0.176-1.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libffi6", Version: "3.2.1-9", Release: "", Epoch: 0, Arch: "", SrcName: "libffi", SrcVersion: "3.2.1-9", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libselinux1", Version: "2.8-1+b1", Release: "", Epoch: 0, Arch: "", SrcName: "libselinux", SrcVersion: "2.8-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-bin", Version: "6.1+20181013-2+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "ncurses", SrcVersion: "6.1+20181013-2+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sysvinit-utils", Version: "2.93-8", Release: "", Epoch: 0, Arch: "", SrcName: "sysvinit", SrcVersion: "2.93-8", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libuuid1", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-base", Version: "6.1+20181013-2+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "ncurses", SrcVersion: "6.1+20181013-2+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libblkid1", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcom-err2", Version: "1.44.5-1+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "e2fsprogs", SrcVersion: "1.44.5-1+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libidn2-0", Version: "2.0.5-1", Release: "", Epoch: 0, Arch: "", SrcName: "libidn2", SrcVersion: "2.0.5-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmnl0", Version: "1.0.4-2", Release: "", Epoch: 0, Arch: "", SrcName: "libmnl", SrcVersion: "1.0.4-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libncursesw6", Version: "6.1+20181013-2+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "ncurses", SrcVersion: "6.1+20181013-2+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpam-modules", Version: "1.3.1-5", Release: "", Epoch: 0, Arch: "", SrcName: "pam", SrcVersion: "1.3.1-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tzdata", Version: "2019b-0+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "tzdata", SrcVersion: "2019b-0+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "grep", Version: "3.3-1", Release: "", Epoch: 0, Arch: "", SrcName: "grep", SrcVersion: "3.3-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "hostname", Version: "3.21", Release: "", Epoch: 0, Arch: "", SrcName: "hostname", SrcVersion: "3.21", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "init-system-helpers", Version: "1.56+nmu1", Release: "", Epoch: 0, Arch: "", SrcName: "init-system-helpers", SrcVersion: "1.56+nmu1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgnutls30", Version: "3.6.7-4", Release: "", Epoch: 0, Arch: "", SrcName: "gnutls28", SrcVersion: "3.6.7-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libp11-kit0", Version: "0.23.15-2", Release: "", Epoch: 0, Arch: "", SrcName: "p11-kit", SrcVersion: "0.23.15-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpam0g", Version: "1.3.1-5", Release: "", Epoch: 0, Arch: "", SrcName: "pam", SrcVersion: "1.3.1-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "debianutils", Version: "4.8.6.1", Release: "", Epoch: 0, Arch: "", SrcName: "debianutils", SrcVersion: "4.8.6.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libacl1", Version: "2.2.53-4", Release: "", Epoch: 0, Arch: "", SrcName: "acl", SrcVersion: "2.2.53-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsmartcols1", Version: "2.33.1-0.1", Release: "", Epoch: 0, Arch: "", SrcName: "util-linux", SrcVersion: "2.33.1-0.1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsystemd0", Version: "241-7~deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "systemd", SrcVersion: "241-7~deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "perl-base", Version: "5.28.1-6", Release: "", Epoch: 0, Arch: "", SrcName: "perl", SrcVersion: "5.28.1-6", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sed", Version: "4.7-1", Release: "", Epoch: 0, Arch: "", SrcName: "sed", SrcVersion: "4.7-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "debconf", Version: "1.5.71", Release: "", Epoch: 0, Arch: "", SrcName: "debconf", SrcVersion: "1.5.71", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "findutils", Version: "4.6.0+git+20190209-2", Release: "", Epoch: 0, Arch: "", SrcName: "findutils", SrcVersion: "4.6.0+git+20190209-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpgv", Version: "2.2.12-1+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "gnupg2", SrcVersion: "2.2.12-1+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libattr1", Version: "1:2.4.48-4", Release: "", Epoch: 0, Arch: "", SrcName: "attr", SrcVersion: "1:2.4.48-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "liblzma5", Version: "5.2.4-1", Release: "", Epoch: 0, Arch: "", SrcName: "xz-utils", SrcVersion: "5.2.4-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libseccomp2", Version: "2.3.3-4", Release: "", Epoch: 0, Arch: "", SrcName: "libseccomp", SrcVersion: "2.3.3-4", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpam-runtime", Version: "1.3.1-5", Release: "", Epoch: 0, Arch: "", SrcName: "pam", SrcVersion: "1.3.1-5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libunistring2", Version: "0.9.10-1", Release: "", Epoch: 0, Arch: "", SrcName: "libunistring", SrcVersion: "0.9.10-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "adduser", Version: "3.118", Release: "", Epoch: 0, Arch: "", SrcName: "adduser", SrcVersion: "3.118", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libaudit-common", Version: "1:2.8.4-3", Release: "", Epoch: 0, Arch: "", SrcName: "audit", SrcVersion: "1:2.8.4-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap2-bin", Version: "1:2.25-2", Release: "", Epoch: 0, Arch: "", SrcName: "libcap2", SrcVersion: "1:2.25-2", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb5.3", Version: "5.3.28+dfsg1-0.5", Release: "", Epoch: 0, Arch: "", SrcName: "db5.3", SrcVersion: "5.3.28+dfsg1-0.5", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libext2fs2", Version: "1.44.5-1+deb10u1", Release: "", Epoch: 0, Arch: "", SrcName: "e2fsprogs", SrcVersion: "1.44.5-1+deb10u1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "liblz4-1", Version: "1.8.3-1", Release: "", Epoch: 0, Arch: "", SrcName: "lz4", SrcVersion: "1.8.3-1", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libzstd1", Version: "1.3.8+dfsg-3", Release: "", Epoch: 0, Arch: "", SrcName: "libzstd", SrcVersion: "1.3.8+dfsg-3", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpcre3", Version: "2:8.39-12", Release: "", Epoch: 0, Arch: "", SrcName: "pcre3", SrcVersion: "2:8.39-12", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsemanage1", Version: "2.8-2", Release: "", Epoch: 0, Arch: "", SrcName: "libsemanage", SrcVersion: "2.8-2", SrcRelease: "", SrcEpoch: 0}},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
		{
			name:              "happy path, photon:1.0",
			imageName:         "photon:1.0-20190823",
			imageFile:         "testdata/fixtures/photon-10.tar.gz",
			expectedFiles:     []string{"var/lib/rpm/Packages", "etc/lsb-release", "etc/os-release", "/config", "usr/lib/os-release"},
			expectedOS:        analyzer.OS{Name: "1.0", Family: "photon"},
			expectedPkgs:      []analyzer.Package{analyzer.Package{Name: "libgcc", Version: "5.3.0", Release: "6.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses", Version: "6.0", Release: "9.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bash", Version: "4.3.48", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pkg-config", Version: "0.28", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpg-error", Version: "1.27", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libassuan", Version: "2.5.1", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bzip2", Version: "1.0.6", Release: "7.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpgme", Version: "1.6.0", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "coreutils", Version: "8.25", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libssh2", Version: "1.9.0", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nspr", Version: "4.21", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss", Version: "3.44", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "util-linux", Version: "2.27.1", Release: "4.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "librepo", Version: "1.7.17", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "file", Version: "5.24", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tcsh", Version: "6.19.00", Release: "7.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "popt", Version: "1.16", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap", Version: "2.25", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb", Version: "5.3.28", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "hawkey", Version: "2014.1", Release: "6.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "photon-release", Version: "1.0", Release: "6.ph1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "vim", Version: "7.4", Release: "12.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "which", Version: "2.21", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "filesystem", Version: "1.1", Release: "4.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc", Version: "2.22", Release: "26.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "readline", Version: "6.3", Release: "5.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "zlib", Version: "1.2.8", Release: "5.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openssl", Version: "1.0.2s", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libstdc++", Version: "5.3.0", Release: "6.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "expat", Version: "2.2.4", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pcre", Version: "8.41", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gmp", Version: "6.0.0a", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ca-certificates", Version: "20190521", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "curl", Version: "7.59.0", Release: "8.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sqlite-autoconf", Version: "3.27.2", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libffi", Version: "3.2.1", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glib", Version: "2.58.3", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "elfutils-libelf", Version: "0.176", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "grep", Version: "2.21", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "lua", Version: "5.3.2", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "attr", Version: "2.4.47", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm", Version: "4.13.0.2", Release: "1.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsolv", Version: "0.6.19", Release: "6.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tdnf", Version: "1.1.0", Release: "3.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "photon-repos", Version: "1.0", Release: "4.ph1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "findutils", Version: "4.6.0", Release: "2.ph1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg-pubkey", Version: "66fd4949", Release: "4803fe57", Epoch: 0, Arch: "(none)", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
		{
			name:              "happy path, registry.redhat.io/ubi7",
			imageName:         "registry.redhat.io/ubi7",
			imageFile:         "testdata/fixtures/ubi-7.tar.gz",
			expectedFiles:     []string{"etc/redhat-release", "etc/system-release", "/config", "var/lib/rpm/Packages", "etc/os-release"},
			expectedOS:        analyzer.OS{Name: "7.7", Family: "redhat"},
			expectedPkgs:      []analyzer.Package{analyzer.Package{Name: "tzdata", Version: "2019b", Release: "1.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "setup", Version: "2.8.71", Release: "10.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "basesystem", Version: "10.0", Release: "7.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-softokn-freebl", Version: "3.44.0", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc", Version: "2.17", Release: "292.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-util", Version: "3.44.0", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-libs", Version: "5.9", Release: "14.20130511.el7_4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsepol", Version: "2.5", Release: "10.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libselinux", Version: "2.5", Release: "14.1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "info", Version: "5.1", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bzip2-libs", Version: "1.0.6", Release: "13.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "popt", Version: "1.13", Release: "16.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libffi", Version: "3.0.13", Release: "18.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libattr", Version: "2.4.46", Release: "13.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap", Version: "2.22", Release: "10.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcrypt", Version: "1.5.3", Release: "14.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "readline", Version: "6.2", Release: "11.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sed", Version: "4.2.2", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcom_err", Version: "1.42.9", Release: "16.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cpio", Version: "2.11", Release: "27.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "grep", Version: "2.20", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap-ng", Version: "0.7.5", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-softokn", Version: "3.44.0", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit", Version: "0.23.5", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gawk", Version: "4.0.2", Release: "4.el7_3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "file-libs", Version: "5.11", Release: "35.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "keyutils-libs", Version: "1.5.8", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "acl", Version: "2.2.51", Release: "14.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb-utils", Version: "5.3.21", Release: "25.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "which", Version: "2.20", Release: "7.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses", Version: "5.9", Release: "14.20130511.el7_4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libverto", Version: "0.2.5", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ustr", Version: "1.0.4", Release: "16.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "hardlink", Version: "1.0", Release: "19.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "qrencode-libs", Version: "3.4.1", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gdbm", Version: "1.10", Release: "8.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit-trust", Version: "0.23.5", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "coreutils", Version: "8.22", Release: "24.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "krb5-libs", Version: "1.15.1", Release: "37.el7_7.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python", Version: "2.7.5", Release: "86.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmount", Version: "2.23.2", Release: "61.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "shared-mime-info", Version: "1.8", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gzip", Version: "1.5", Release: "10.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "shadow-utils", Version: "4.6", Release: "5.el7", Epoch: 2, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpwquality", Version: "1.2.3", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gobject-introspection", Version: "1.56.1", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-six", Version: "1.9.0", Release: "2.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-dmidecode", Version: "3.12.2", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libutempter", Version: "1.1.6", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-metadata-parser", Version: "1.1.4", Release: "10.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-backports", Version: "1.0", Release: "8.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-ipaddress", Version: "1.0.16", Release: "2.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-setuptools", Version: "0.9.8", Release: "7.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pyxattr", Version: "0.5.1", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-chardet", Version: "2.2.1", Release: "3.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-inotify", Version: "0.9.4", Release: "4.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libssh2", Version: "1.8.0", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss", Version: "3.44.0", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-tools", Version: "3.44.0", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "curl", Version: "7.29.0", Release: "54.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm", Version: "4.11.3", Release: "40.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libuser", Version: "0.60", Release: "9.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-pycurl", Version: "7.19.0", Release: "19.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "binutils", Version: "2.27", Release: "41.base.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gnupg2", Version: "2.0.22", Release: "5.el7_5", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-python", Version: "4.11.3", Release: "40.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pygpgme", Version: "0.3", Release: "9.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "json-c", Version: "0.11", Release: "4.el7_0", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "procps-ng", Version: "3.3.10", Release: "26.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "device-mapper", Version: "1.02.158", Release: "2.el7", Epoch: 7, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cryptsetup-libs", Version: "2.0.3", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "kmod", Version: "20", Release: "25.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "systemd-libs", Version: "219", Release: "67.el7_7.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "systemd", Version: "219", Release: "67.el7_7.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dbus", Version: "1.10.24", Release: "13.el7_6", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dbus-python", Version: "1.1.1", Release: "9.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "usermode", Version: "1.111", Release: "6.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "subscription-manager-rhsm", Version: "1.24.13", Release: "3.el7_7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-plugin-ovl", Version: "1.1.31", Release: "52.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gdb-gdbserver", Version: "7.6.1", Release: "115.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcc", Version: "4.8.5", Release: "39.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "redhat-release-server", Version: "7.7", Release: "10.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "filesystem", Version: "3.2", Release: "25.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-base", Version: "5.9", Release: "14.20130511.el7_4", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc-common", Version: "2.17", Release: "292.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nspr", Version: "4.21.0", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libstdc++", Version: "4.8.5", Release: "39.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bash", Version: "4.2.46", Release: "33.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pcre", Version: "8.32", Release: "17.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "zlib", Version: "1.2.7", Release: "18.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "xz-libs", Version: "5.2.2", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdb", Version: "5.3.21", Release: "25.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "elfutils-libelf", Version: "0.176", Release: "2.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpg-error", Version: "1.12", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libacl", Version: "2.2.51", Release: "14.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "chkconfig", Version: "1.7.4", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libxml2", Version: "2.9.1", Release: "6.el7_2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "lua", Version: "5.1.4", Release: "15.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libuuid", Version: "2.23.2", Release: "61.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sqlite", Version: "3.7.17", Release: "8.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "diffutils", Version: "3.3", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "expat", Version: "2.1.0", Release: "10.el7_3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "audit-libs", Version: "2.8.5", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libassuan", Version: "2.1.0", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "xz", Version: "5.2.2", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "findutils", Version: "4.5.11", Release: "6.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "lz4", Version: "1.7.5", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pinentry", Version: "0.8.1", Release: "17.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "tar", Version: "1.26", Release: "35.el7", Epoch: 2, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "kmod-libs", Version: "20", Release: "25.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libidn", Version: "1.28", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gmp", Version: "6.0.0", Release: "15.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnl", Version: "1.1.4", Release: "3.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsemanage", Version: "2.5", Release: "14.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dmidecode", Version: "3.2", Release: "3.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsmartcols", Version: "2.23.2", Release: "61.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtasn1", Version: "4.10", Release: "1.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ca-certificates", Version: "2018.2.22", Release: "70.0.el7_5", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openssl-libs", Version: "1.0.2k", Release: "19.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-libs", Version: "2.7.5", Release: "86.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libblkid", Version: "2.23.2", Release: "61.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glib2", Version: "2.56.1", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-iniparse", Version: "0.4", Release: "9.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cracklib", Version: "2.9.0", Release: "11.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cracklib-dicts", Version: "2.9.0", Release: "11.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pam", Version: "1.1.8", Release: "22.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-dateutil", Version: "1.5", Release: "7.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libxml2-python", Version: "2.9.1", Release: "6.el7_2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-gobject-base", Version: "3.22.0", Release: "1.el7_4.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pkgconfig", Version: "0.27.1", Release: "4.el7", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-ethtool", Version: "0.8", Release: "8.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-decorator", Version: "3.4.0", Release: "3.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-backports-ssl_match_hostname", Version: "3.5.0.1", Release: "1.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pyliblzma", Version: "0.5.3", Release: "11.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-syspurpose", Version: "1.24.13", Release: "3.el7_7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-kitchen", Version: "1.1.1", Release: "5.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cyrus-sasl-lib", Version: "2.1.26", Release: "23.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-pem", Version: "1.0.3", Release: "7.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "nss-sysinit", Version: "3.44.0", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcurl", Version: "7.29.0", Release: "54.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-libs", Version: "4.11.3", Release: "40.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openldap", Version: "2.4.44", Release: "21.el7_6", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "passwd", Version: "0.79", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "python-urlgrabber", Version: "3.10", Release: "9.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pth", Version: "2.0.7", Release: "23.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm-build-libs", Version: "4.11.3", Release: "40.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpgme", Version: "1.3.2", Release: "5.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum", Version: "3.4.3", Release: "163.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "util-linux", Version: "2.23.2", Release: "61.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "kpartx", Version: "0.4.9", Release: "127.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "device-mapper-libs", Version: "1.02.158", Release: "2.el7", Epoch: 7, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dracut", Version: "033", Release: "564.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "elfutils-libs", Version: "0.176", Release: "2.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dbus-libs", Version: "1.10.24", Release: "13.el7_6", Epoch: 1, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "elfutils-default-yama-scope", Version: "0.176", Release: "2.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "dbus-glib", Version: "0.100", Release: "7.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "virt-what", Version: "1.18", Release: "4.el7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "subscription-manager-rhsm-certificates", Version: "1.24.13", Release: "3.el7_7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "subscription-manager", Version: "1.24.13", Release: "3.el7_7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "yum-utils", Version: "1.1.31", Release: "52.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "vim-minimal", Version: "7.4.629", Release: "6.el7", Epoch: 2, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rootfiles", Version: "8.1", Release: "11.el7", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
		{
			name:              "happy path, opensuse leap 15.1",
			imageName:         "opensuse/leap:latest",
			imageFile:         "testdata/fixtures/opensuse-leap-151.tar.gz",
			expectedFiles:     []string{"usr/lib/os-release", "usr/lib/sysimage/rpm/Packages", "/config", "etc/os-release"},
			expectedOS:        analyzer.OS{Name: "15.1", Family: "opensuse.leap"},
			expectedPkgs:      []analyzer.Package{analyzer.Package{Name: "cracklib-dict-small", Version: "2.9.6", Release: "lp151.3.69", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtirpc-netconfig", Version: "1.0.2", Release: "lp151.4.8", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "system-user-root", Version: "20190513", Release: "lp151.3.3.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "glibc", Version: "2.26", Release: "lp151.18.7", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libverto1", Version: "0.2.6", Release: "lp151.4.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsepol1", Version: "2.8", Release: "lp151.1.36", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpopt0", Version: "1.16", Release: "lp151.3.67", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnpth0", Version: "1.5", Release: "lp151.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "liblua5_3-5", Version: "5.3.4", Release: "lp151.3.25", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpg-error0", Version: "1.29", Release: "lp151.2.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcc_s1", Version: "8.2.1+r264010", Release: "lp151.1.33", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap2", Version: "2.25", Release: "lp151.3.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libaudit1", Version: "2.8.1", Release: "lp151.4.66", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "fillup", Version: "1.42", Release: "lp151.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libselinux1", Version: "2.8", Release: "lp151.1.30", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libassuan0", Version: "2.5.1", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libstdc++6", Version: "8.2.1+r264010", Release: "lp151.1.33", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libacl1", Version: "2.2.52", Release: "lp151.4.29", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libncurses6", Version: "6.1", Release: "lp151.5.41", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libboost_system1_66_0", Version: "1.66.0", Release: "lp151.4.5", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libproxy1", Version: "0.4.15", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ncurses-utils", Version: "6.1", Release: "lp151.5.41", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libz1", Version: "1.2.11", Release: "lp151.5.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsqlite3-0", Version: "3.28.0", Release: "lp151.2.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnghttp2-14", Version: "1.39.2", Release: "lp151.3.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "liblz4-1", Version: "1.8.0", Release: "lp151.3.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libbz2-1", Version: "1.0.6", Release: "lp151.5.9.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libudev1", Version: "234", Release: "lp151.26.4.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libopenssl1_1", Version: "1.1.0i", Release: "lp151.8.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libxml2-2", Version: "2.9.7", Release: "lp151.5.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsystemd0", Version: "234", Release: "lp151.26.4.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libldap-2_4-2", Version: "2.4.46", Release: "lp151.10.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmount1", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libelf1", Version: "0.168", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libssh4", Version: "0.8.7", Release: "lp151.2.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "procps", Version: "3.3.15", Release: "lp151.6.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmagic1", Version: "5.32", Release: "lp151.7.22", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsemanage1", Version: "2.8", Release: "lp151.1.32", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libaugeas0", Version: "1.10.1", Release: "lp151.2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtirpc3", Version: "1.0.2", Release: "lp151.4.8", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcrack2", Version: "2.9.6", Release: "lp151.3.69", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sed", Version: "4.4", Release: "lp151.3.4", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "findutils", Version: "4.6.0", Release: "lp151.3.71", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cpio", Version: "2.12", Release: "lp151.2.68", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "update-alternatives", Version: "1.19.0.4", Release: "lp151.3.67", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gawk", Version: "4.2.1", Release: "lp151.2.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtasn1-6", Version: "4.13", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsolv-tools", Version: "0.7.6", Release: "lp151.2.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libtasn1", Version: "4.13", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg2", Version: "2.2.5", Release: "lp151.6.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgpgme11", Version: "1.10.0", Release: "lp151.4.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libzypp", Version: "17.15.0", Release: "lp151.2.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "sysuser-shadow", Version: "2.0", Release: "lp151.3.70", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libutempter0", Version: "1.1.6", Release: "lp151.4.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "aaa_base", Version: "84.87+git20180409.04c9dae", Release: "lp151.5.12.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openSUSE-build-key", Version: "1.0", Release: "lp151.3.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit", Version: "0.23.2", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openssl", Version: "1.1.0i", Release: "lp151.1.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ca-certificates-mozilla", Version: "2.34", Release: "lp151.2.3.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg-pubkey", Version: "39db7c82", Release: "5847eb1f", Epoch: 0, Arch: "(none)", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "boost-license1_66_0", Version: "1.66.0", Release: "lp151.4.5", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "file-magic", Version: "5.32", Release: "lp151.7.22", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openSUSE-release-appliance-docker", Version: "15.1", Release: "lp151.301.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "filesystem", Version: "15.0", Release: "lp151.9.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "perl-base", Version: "5.26.1", Release: "lp151.8.37", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libunistring2", Version: "0.9.9", Release: "lp151.2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsasl2-3", Version: "2.1.26", Release: "lp151.5.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpcre1", Version: "8.41", Release: "lp151.5.67", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnettle6", Version: "3.4.1", Release: "lp151.1.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libkeyutils1", Version: "1.5.10", Release: "lp151.4.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgmp10", Version: "6.1.2", Release: "lp151.3.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libffi7", Version: "3.2.1.git259", Release: "lp151.5.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcap-ng0", Version: "0.7.9", Release: "lp151.3.39", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libattr1", Version: "2.4.47", Release: "lp151.3.70", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libidn2-0", Version: "2.0.4", Release: "lp151.2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libksba8", Version: "1.3.5", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libhogweed4", Version: "3.4.1", Release: "lp151.1.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libp11-kit0", Version: "0.23.2", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libpsl5", Version: "0.20.1", Release: "lp151.2.43", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libmodman1", Version: "2.0.1", Release: "lp151.2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "terminfo-base", Version: "6.1", Release: "lp151.5.41", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libboost_thread1_66_0", Version: "1.66.0", Release: "lp151.4.5", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libzstd1", Version: "1.4.2", Release: "lp151.3.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libuuid1", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libsmartcols1", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "liblzma5", Version: "5.2.3", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcom_err2", Version: "1.43.8", Release: "lp151.5.6.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgcrypt20", Version: "1.8.2", Release: "lp151.9.4.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libreadline7", Version: "7.0", Release: "lp151.10.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libblkid1", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libdw1", Version: "0.168", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "bash", Version: "4.4", Release: "lp151.10.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "krb5", Version: "1.16.3", Release: "lp151.2.6.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libfdisk1", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libprocps7", Version: "3.3.15", Release: "lp151.6.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libebl-plugins", Version: "0.168", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libcurl4", Version: "7.60.0", Release: "lp151.5.6.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libzio1", Version: "1.06", Release: "lp151.3.71", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libusb-1_0-0", Version: "1.0.21", Release: "lp151.2.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "cracklib", Version: "2.9.6", Release: "lp151.3.69", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "info", Version: "6.5", Release: "lp151.5.69", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libnsl2", Version: "1.2.0", Release: "lp151.3.67", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "grep", Version: "3.1", Release: "lp151.3.29", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "diffutils", Version: "3.6", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "coreutils", Version: "8.29", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "rpm", Version: "4.14.1", Release: "lp151.13.10", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pinentry", Version: "1.1.0", Release: "lp151.4.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "permissions", Version: "20181116", Release: "lp151.4.6.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openSUSE-release", Version: "15.1", Release: "lp151.301.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "libgnutls30", Version: "3.6.7", Release: "lp151.2.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "pam", Version: "1.3.0", Release: "lp151.7.38", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "shadow", Version: "4.6", Release: "lp151.2.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "zypper", Version: "1.14.30", Release: "lp151.2.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "system-group-hardware", Version: "20170617", Release: "lp151.4.70", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "util-linux", Version: "2.33.1", Release: "lp151.3.3.2", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "kubic-locale-archive", Version: "2.26", Release: "lp151.4.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "netcfg", Version: "11.6", Release: "lp151.2.2", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "p11-kit-tools", Version: "0.23.2", Release: "lp151.3.3", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "openssl-1_1", Version: "1.1.0i", Release: "lp151.8.3.1", Epoch: 0, Arch: "x86_64", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "ca-certificates", Version: "2+git20170807.10b2785", Release: "lp151.7.1", Epoch: 0, Arch: "noarch", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg-pubkey", Version: "307e3d54", Release: "5aaa90a5", Epoch: 0, Arch: "(none)", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}, analyzer.Package{Name: "gpg-pubkey", Version: "3dbdc284", Release: "53674dd4", Epoch: 0, Arch: "(none)", SrcName: "", SrcVersion: "", SrcRelease: "", SrcEpoch: 0}},
			expectedLibraries: map[analyzer.FilePath][]godeptypes.Library{},
		},
	}

	for _, tc := range testCases {
		ctx := context.Background()
		d, _ := ioutil.TempDir("", "TestFanal_Library_*")
		defer func() {
			_ = os.RemoveAll(d)
		}()
		c, _ := cache.New(d)

		opt := types.DockerOption{
			Timeout:  600 * time.Second,
			SkipPing: true,
		}

		cli, err := client.NewClientWithOpts(client.FromEnv)
		require.NoError(t, err, tc.name)

		// ensure image doesnt already exists
		_, _ = cli.ImageRemove(ctx, tc.imageFile, dtypes.ImageRemoveOptions{
			Force:         true,
			PruneChildren: true,
		})

		testfile, err := os.Open(tc.imageFile)
		require.NoError(t, err)

		// load image into docker engine
		_, err = cli.ImageLoad(ctx, testfile, true)
		require.NoError(t, err, tc.name)

		// tag our image to something unique
		err = cli.ImageTag(ctx, tc.imageName, tc.imageFile)
		require.NoError(t, err, tc.name)

		ext, err := docker.NewDockerExtractor(opt, c)
		require.NoError(t, err, tc.name)
		ac := analyzer.Config{Extractor: ext}

		actualFiles, err := ac.Analyze(ctx, tc.imageFile)
		require.NoError(t, err)
		for file, _ := range actualFiles {
			assert.Contains(t, tc.expectedFiles, file, tc.name)
		}
		assert.Equal(t, len(tc.expectedFiles), len(actualFiles), tc.name)

		// check OS
		osFound, err := analyzer.GetOS(actualFiles)
		require.NoError(t, err)
		assert.Equal(t, tc.expectedOS, osFound, tc.name)

		// check Packages
		actualPkgs, err := analyzer.GetPackages(actualFiles)
		require.NoError(t, err)
		assert.ElementsMatch(t, tc.expectedPkgs, actualPkgs, tc.name)

		// check Packges from Commands
		actualPkgsFromCmds, err := analyzer.GetPackagesFromCommands(osFound, actualFiles)
		require.NoError(t, err)
		assert.Equal(t, tc.expectedPkgsFromCmds, actualPkgsFromCmds, tc.name)

		// check Libraries
		actualLibs, err := analyzer.GetLibraries(actualFiles)
		require.NoError(t, err)
		assert.Equal(t, tc.expectedLibraries, actualLibs, tc.name)

		// check Cache
		actualCachedFiles, _ := ioutil.ReadDir(d + "/fanal/")
		require.Equal(t, 1, len(actualCachedFiles), tc.name)

		// check Cache contents
		var actualCacheValue []byte
		found, err := c.Get("imagebucket", tc.imageFile, &actualCacheValue)
		require.NoError(t, err)
		assert.True(t, found)
		assert.NotEmpty(t, actualCacheValue, tc.name)

		// clear Cache
		require.NoError(t, c.Clear(), tc.name)

		// remove Image
		_, err = cli.ImageRemove(ctx, tc.imageFile, dtypes.ImageRemoveOptions{
			Force:         true,
			PruneChildren: true,
		})
		assert.NoError(t, err, tc.name)
	}
}
